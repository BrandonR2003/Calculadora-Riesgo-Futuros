<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calculadora Riesgo Futuros</title>
<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
  background:#121212;
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
#container{display:flex;gap:40px}
.card{
  background:#1e1e1e;
  padding:20px;
  border-radius:20px;
  width:350px;
}
label{display:block;margin-top:6px;font-size:.9rem}
select,input{
  width:100%;
  padding:6px;
  margin-top:2px;
  background:#2c2c2c;
  border:none;
  border-radius:8px;
  color:white;
}
button{
  width:100%;
  margin-top:15px;
  padding:10px;
  background:#0a84ff;
  border:none;
  border-radius:10px;
  color:white;
  cursor:pointer;
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
  font-size:.85rem;
}
th,td{
  border:1px solid #333;
  padding:6px;
  text-align:center;
}
th{background:#2c2c2c}
.best-row{background:#0a84ff66;font-weight:bold;color:#fff;}
</style>
</head>
<body>
<div id="container">

<div class="card">
<h2>DATOS</h2>

<label>Cuenta:</label>
<select id="cuenta">
  <option value="APEX">APEX</option>
  <option value="FN">FN Futures</option>
</select>

<label>Activo:</label>
<select id="activo"></select>

<label>Capital:</label>
<select id="capital">
  <option value="25000">$25,000</option>
  <option value="50000">$50,000</option>
  <option value="100000">$100,000</option>
  <option value="150000">$150,000</option>
  <option value="250000">$250,000</option>
</select>

<label>SL (tics):</label>
<input type="number" id="slTics">

<button onclick="calcular()">Calcular</button>
</div>

<div class="card" id="resultCard" style="display:none">
<h2>OPCIONES DE RIESGO</h2>
<table>
<thead>
<tr>
<th>Riesgo %</th>
<th>Contratos</th>
<th>Tics Máx</th>
<th>Diferencia</th>
</tr>
</thead>
<tbody id="tabla"></tbody>
</table>
</div>

</div>

<script>
// --- CONFIG ---
const riesgos = [0.01,0.008,0.0075,0.006,0.005,0.0045,0.004,0.0033,0.003,0.0025,0.002,0.0015,0.00125,0.001,0.0005];

const activosPorCuenta = {
  FN: ["ES","MES","NQ","MNQ","RTY","M2K","HE","LE","6A","M6A","6B","6C","6E","6J","6N","6S","YM","MYM","ZC","ZL","ZM","ZS","ZW","GC","MGC","HG","MHG","SI","CL","QM","MCL","NG","QG","RB"],
  APEX: ["EMD","ES","MES","NQ","MNQ","RTY","M2K","MBT","MET","GF","HE","LE","6A","M6A","6B","6C","6E","M6E","6J","6N","6S","YM","MYM","ZC","ZL","ZM","ZS","ZW","GC","QO","MGC","HG","QI","SI","CL","QM","MCL","HO","NG","QG","RB"]
};

const nombresActivos = {
  "ES": "E-MINI S&P 500",
  "MES": "MICRO S&P 500",
  "NQ": "E-MINI NASDAQ",
  "MNQ": "MICRO NASDAQ",
  "RTY": "E-MINI RUSSELL",
  "M2K": "MICRO RUSSELL",
  "HE": "LEAN HOG",
  "LE": "LIVE CATTLE",
  "6A": "AUSTRALIAN DOLLAR",
  "M6A": "E-MICRO AUD/USD",
  "6B": "BRITISH POUND",
  "6C": "CANADIAN DOLLAR",
  "6E": "EURO",
  "M6E": "E-MICRO EUR/USD",
  "6J": "JAPANESE YEN",
  "6N": "NEW ZEALAND",
  "6S": "SWISS FRANC",
  "YM": "E-MINI DOW JONES INDEX",
  "MYM": "MICRO E-MINI DOW JONES INDEX",
  "ZC": "CORN",
  "ZL": "SOYBEAN OIL",
  "ZM": "SOYBEAN MEAL",
  "ZS": "SOYBEAN",
  "ZW": "WHEAT",
  "GC": "COMEX GOLD",
  "QO": "E-MINI GOLD",
  "MGC": "10 TROY OZ GOLD",
  "HG": "COMEX COPPER",
  "MHG": "MICRO COPPER",
  "SI": "COMEX SILVER",
  "CL": "CRUDE OIL",
  "QM": "E-MINI CRUDE OIL",
  "MCL": "MICRO CRUDE OIL",
  "NG": "NATURAL GAS",
  "QG": "E-MINI NATURAL GAS",
  "RB": "RBOB GASOLINE",
  "QI": "COMEX MINY SILVER",
  "GF": "FEEDER CATTLE",
  "MBT": "MICRO BITCOIN",
  "MET": "MICRO ETHER",
  "EMD": "E-MINI MIDCAP",
  "HO": "NY HARBOR ULSD"
};

// --- Datos de cada activo con tickValue ---
const activos = {
    "EMD":{ tickSize: 0.10, tickValue: 0.00, comision: { APEX: 1.0, FN: 0.00 }, dec: 1 },
    "ES": { tickSize: 0.25, tickValue: 12.5, comision: { APEX: 3.10, FN: 5.76 }, dec: 2 },
    "MES": { tickSize: 0.25, tickValue: 1.25, comision: { APEX: 1.04, FN: 1.90 }, dec: 2 },
    "NQ": { tickSize: 0.25, tickValue: 5, comision: { APEX: 3.10, FN: 5.76 }, dec: 2 },
    "MNQ": { tickSize: 0.25, tickValue: 0.5, comision: { APEX: 1.04, FN: 1.90 }, dec: 2 },
    "RTY":{ tickSize: 0.1, tickValue: 5, comision: { APEX: 3.10, FN: 5.76 }, dec: 1 },
    "M2K":{ tickSize: 0.1, tickValue: 0.5, comision: { APEX: 1.04, FN: 1.9 }, dec: 1 },
    "MBT":{ tickSize: 5, tickValue: 0.50, comision: { APEX: 5.34, FN: 0.00 }, dec: 0 },
    "MET":{ tickSize: 0.5, tickValue: 0.05, comision: { APEX: 0.74, FN: 0.00 }, dec: 1 },
    "GF":{ tickSize: 0.03, tickValue: 12.50, comision: { APEX: 4.54, FN: 6.20 }, dec: 3 },
    "HE":{ tickSize: 0.03, tickValue: 10.0, comision: { APEX: 4.54, FN: 7.2 }, dec: 3 },
    "LE":{ tickSize: 0.03, tickValue: 10.0, comision: { APEX: 4.54, FN: 7.2 }, dec: 3 },
    "6A":{ tickSize: 0.00005, tickValue: 5.0, comision: { APEX: 3.54, FN: 6.2 }, dec: 5 },
    "M6A":{ tickSize: 0.0001, tickValue: 10.0, comision: { APEX: 0.82, FN: 1.68 }, dec: 4 },
    "6B":{ tickSize: 0.0001, tickValue: 6.25, comision: { APEX: 3.54, FN: 6.20 }, dec: 4 },
    "6C":{ tickSize: 0.00005, tickValue: 5.00, comision: { APEX: 3.54, FN: 6.20 }, dec: 5 },
    "6E":{ tickSize: 0.00005, tickValue: 6.25, comision: { APEX: 3.54, FN: 6.20 }, dec: 5 },
    "M6E":{ tickSize: 0.0001, tickValue: 1.25, comision: { APEX: 0.82, FN: 0.00 }, dec: 4 },
    "6J":{ tickSize: 0.0000005, tickValue: 6.25, comision: { APEX: 3.54, FN: 6.20 }, dec: 7 },
    "6N":{ tickSize: 0.00005, tickValue: 5.00, comision: { APEX: 3.54, FN: 6.20 }, dec: 5 },
    "6S":{ tickSize: 0.00005, tickValue: 6.25, comision: { APEX: 3.54, FN: 6.20 }, dec: 5 },
    "YM":{ tickSize: 1.00, tickValue: 5.00, comision: { APEX: 3.10, FN: 5.76 }, dec: 0 },
    "MYM":{ tickSize: 1.00, tickValue: 0.50, comision: { APEX: 1.04, FN: 1.90 }, dec: 0 },
    "ZC":{ tickSize: 0.25, tickValue: 12.50, comision: { APEX: 4.54, FN: 1.00 }, dec: 2 },
    "ZL":{ tickSize: 0.01, tickValue: 6.00, comision: { APEX: 4.54, FN: 7.20 }, dec: 2 },
    "ZM":{ tickSize: 0.1, tickValue: 10.00, comision: { APEX: 4.54, FN: 7.20 }, dec: 1 },
    "ZS":{ tickSize: 0.25, tickValue: 12.50, comision: { APEX: 4.54, FN: 0.00 }, dec: 2 },
    "ZW":{ tickSize: 0.25, tickValue: 12.50, comision: { APEX: 4.54, FN: 0.00 }, dec: 2 },
    "GC":{ tickSize: 0.1, tickValue: 10.00, comision: { APEX: 3.54, FN: 6.20 }, dec: 1 },
    "QO":{ tickSize: 0.25, tickValue: 12.50, comision: { APEX: 2.34, FN: 0.00 }, dec: 2 },
    "MGC":{ tickSize: 0.1, tickValue: 1.00, comision: { APEX: 1.34, FN: 2.40 }, dec: 1 },
    "HG":{ tickSize: 0.0005, tickValue: 12.50, comision: { APEX: 3.54, FN: 6.20 }, dec: 4 },
    "MHG":{ tickSize: 0.0005, tickValue: 1.25, comision: { APEX: 0.0, FN: 2.40 }, dec: 4 },
    "QI":{ tickSize: 0.0125, tickValue: 31.25, comision: { APEX: 2.34, FN: 0.00 }, dec: 4 },
    "SI":{ tickSize: 0.005, tickValue: 25.00, comision: { APEX: 3.54, FN: 6.20 }, dec: 3 },
    "CL":{ tickSize: 0.01, tickValue: 10.00, comision: { APEX: 3.54, FN: 6.00 }, dec: 2 },
    "QM":{ tickSize: 0.025, tickValue: 12.50, comision: { APEX: 2.74, FN: 5.40 }, dec: 3 },
    "MCL":{ tickSize: 0.01, tickValue: 1.00, comision: { APEX: 1.34, FN: 2.20 }, dec: 2 },
    "HO":{ tickSize: 0.05, tickValue: 1.25, comision: { APEX: 0.0, FN: 0.00 }, dec: 4 },
    "NG":{ tickSize: 0.001, tickValue: 10.00, comision: { APEX: 3.54, FN: 6.20 }, dec: 3 },
    "QG":{ tickSize: 0.005, tickValue: 12.50, comision: { APEX: 1.34, FN: 4.00 }, dec: 3 },
    "RB":{ tickSize: 0.0001, tickValue: 4.20, comision: { APEX: 3.34, FN: 6.00 }, dec: 4 },
  };

// --- FILTRO DINÁMICO ---
const selectCuenta = document.getElementById("cuenta");
const selectActivo = document.getElementById("activo");

function actualizarActivos(){
  const cuenta = selectCuenta.value;
  const activosPermitidos = activosPorCuenta[cuenta];
  const actual = selectActivo.value;
  selectActivo.innerHTML = "";

  activosPermitidos.forEach(a => {
    if(!activos[a]) return; 
    const option = document.createElement("option");
    option.value = a;
    option.textContent = `${a} (${nombresActivos[a] || ""})`;
    selectActivo.appendChild(option);
  });

  if(activosPermitidos.includes(actual)) selectActivo.value = actual;
}

selectCuenta.addEventListener("change", actualizarActivos);

document.addEventListener("DOMContentLoaded", () => {
  actualizarActivos();
});

// --- CALCULO ---
const capitalEl = document.getElementById("capital");
const slTics = document.getElementById("slTics");
const tabla = document.getElementById("tabla");

function calcular() {
  const capital = +capitalEl.value;
  const sl = +slTics.value;
  const cuenta = selectCuenta.value;
  const activoSel = selectActivo.value;

  if (!activos[activoSel]) return alert("Activo no definido");
  if (sl <= 0) return alert("SL inválido");

  const act = activos[activoSel];
  tabla.innerHTML = "";

  let opciones = [];

  riesgos.forEach(r => {
  const riesgoUSD = capital * r;

  const riesgoPorContrato =
    (sl * act.tickValue) + act.comision[cuenta];

  const contratos = Math.floor(riesgoUSD / riesgoPorContrato);
  if (contratos < 1) return;

  const ticsMax = Math.floor(
    (riesgoUSD / contratos - act.comision[cuenta]) / act.tickValue
  );

  const gap = ticsMax - sl;

  opciones.push({
    r,
    contratos,
    ticsMax,
    gap
  });
});

// ✅ AHORA SÍ: ordenar una sola vez
opciones.sort((a, b) => Math.abs(a.gap) - Math.abs(b.gap));

// ✅ pintar la tabla una sola vez
opciones.forEach((o, i) => {
  tabla.insertAdjacentHTML("beforeend", `
    <tr class="${i === 0 ? 'best-row' : ''}">
      <td>${(o.r * 100).toFixed(3)}%</td>
      <td>${o.contratos}</td>
      <td>${o.ticsMax}</td>
      <td>${o.gap >= 0 ? '+' : ''}${o.gap}</td>
    </tr>
  `);
});

document.getElementById("resultCard").style.display = "block";
  
</script>
</body>
</html>
